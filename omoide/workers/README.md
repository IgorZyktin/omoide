# Фоновые задачи

Не все операции можно исполнить на месте в API. Часть операций приходится
исполнять дополнительными процессами в фоне. Обычно для такого используют
инструменты вроде `celery`, но здесь мы используем самописных воркеров.

## Worker Converter

Занимается преобразованием полученных файлов от пользователя. Именно он порождает иконки (thumbnail)
и уменьшенные варианты картинок (preview). Работает синхронно, в один процесс. Но можно запустить
несколько экземпляров, чтобы работа шла быстрее.

## Список того, что делается в фоне

| Операция               | Значение                                                          | Параллелизм                                                               | Кто исполняет   |
|------------------------|-------------------------------------------------------------------|---------------------------------------------------------------------------|-----------------|
| Изменение прав доступа | Изменение прав доступа к записи, опционально её родителей и детей | В общем нет, но можно попытаться делать для каждого пользователя отдельно | worker_serial   |
| Изменение тегов        | Изменение тегов записи, а также её дочерних записей               | Нет, возможно влияние пользователей друг на друга                         | worker_serial   |
| Первичная загрузка     | Приём картинки от пользователя                                    | Возможно, но в настоящий момент не используется                           | worker_serial   |
| Копирование контента   | Скопировать все картинки из одной записи в другую                 | Да                                                                        | worker_parallel |
| Удаление контента      | Фактическое удаление данных с файловой системы                    | Да                                                                        | worker_parallel |
| Скачивание контента    | Перенос данных из базы на файловую систему                        | Да                                                                        | worker_parallel |
